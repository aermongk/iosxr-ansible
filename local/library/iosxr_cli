#!/usr/bin/python
#
# Copyright 2016 Cisco Systems
#

def main():
  module = AnsibleModule(
    argument_spec = dict(
      host = dict(required=True),
      username = dict(required=True),
      password = dict(required=True),
      command = dict(required=True)
    ),
    supports_check_mode = True
  )

  host = module.params['host']
  username = module.params['username']
  password = module.params['password']
  command = module.params['command']

  #ssh = paramiko.SSHClient()
  #ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())
  #ssh.connect(hostname=host, port=22, username=username, password=password,
  #  timeout=10, look_for_keys=None, allow_agent=False)
  #shell = ssh.invoke_shell()
  #response = shell.recv(200)
  #shell.send('pwd')
  #response = shell.recv(200)
  #response = ssh.exec_command("pwd",timeout=10)

  shell = Shell()
  shell.open(host=host, username=username, password=password)
  shell.send('terminal length 0')
  response = shell.send(command)

  result = dict(changed=False)
  result['stdout'] = response
  result['stdout_lines'] = str(result['stdout']).split(r'\n')
  module.exit_json(**result)

import json
from ansible.module_utils.basic import *
from ansible.module_utils.shell import *
if __name__ == "__main__":
  main()
