diff -r ./library/iosxr_install_package /tftpboot/iosxr-ansible/local/library/iosxr_install_package
137,140c137,140
<                 response.append(execute_command(module, command))
<             for rmsg in response[0]:
<                 if 'aborted' in rmsg:
<                     module.fail_json(msg=rmsg)
---
>                 rmsg = module.execute(command)
>                 if 'aborted' in rmsg[0]:
>                     module.fail_json(msg=rmsg[0])
>                 response.append(rmsg[0])
292c292
<         module.fail_json(msg="other install op in progress")
---
>         module.fail_json(msg="other install operation in progress")
Only in /tftpboot/iosxr-ansible/local/library: iosxr_upgrade_activate
diff -r ./library/iosxr_upgrade_package /tftpboot/iosxr-ansible/local/library/iosxr_upgrade_package
49a50,54
>   confirm:
>     description:
>       - make sure user really want to reload
>     required: true
>     value: "yes" or other string
77a83
>     confirm: yes
107a114
>             confirm = dict(required=True),
117a125,128
>     # confirm upgrade
>     if args['confirm'] != 'yes':
>         module.fail_json(msg='upgrade aborted')
> 
120c131
<         module.fail_json(msg="install upgrade cannot run on 32-bit IOS-XR")
---
>         module.fail_json(msg='this upgrade module cannot run on 32-bit IOS-XR')
124c135,138
<         module.fail_json(msg="other install op in progress")
---
>         module.fail_json(msg='other install operation in progress')
> 
>     # ignore timeout
>     module.connection.shell.shell.settimeout(None)
128c142
<                pkg_path + ' version ' + version + ' ' + pkg_name + '\r')
---
>                pkg_path + ' version ' + version + ' ' + pkg_name + '\n')
131,135c145,151
<     try:
<         # collect all responses 1024 bytes at a time
<         prompt = re.compile(r'[\r\n]?[\w+\-\.:\/\[\]]+(?:>|#)')
<         response = module.connection.shell.shell.recv(1024)
<         while not prompt.search(response):
---
>     response = ''
>     prompt = re.compile(r'[\r\n]?[\w+\-\.:\/\[\]]+(?:>|#)')
>     ask = re.compile(r'[\r\n]?\[yes\/no]:\[\w+]\s')
> 
>     # wait for either command prompt or activate prompt
>     while True:
>         try:
137,143c153,176
<     except:
<         response += '\r\nNOTE: install upgrade is running in background and can take a long time, use "show install <request|log>" command to check its status\r\n'
<         pass
< 
<     # check result
<     if 'aborted' in response:
<         module.fail_json(msg=response)
---
> 
>             # if activate prompt then send yes
>             if ask.search(response):
>                 module.connection.shell.shell.send('yes\n')
>                 break
> 
>             # if command prompt then it probably is error response
>             elif prompt.search(response):
>                 if 'aborted' in response:
>                     module.fail_json(msg=response)
>                 break
>         except:
>             break
> 
>     # now wait till reload
>     while True:
>         try:
>             #  install operation done
>             if not is_install_in_progress(module):
>                 break
>             sleep(5)
>         # or socket exception when reload
>         except:
>             break
Only in /tftpboot/iosxr-ansible/local/samples: iosxr_upgrade_activate.yml
diff -r ./samples/iosxr_upgrade_package.yml /tftpboot/iosxr-ansible/local/samples/iosxr_upgrade_package.yml
2c2
< - hosts: ss-xr
---
> - hosts: 192.168.1.5
5a6,9
>   vars_prompt:
>   - name: yesno
>     prompt: 'Upgrade can take an hour to finish, are you sure you want to contiue (yes/no)? '
> 
7c11
<   - name: upgrade IOS-XR software version
---
>   - name: upgrade IOS-XR software version, please do not hit Ctrl-C
10a15
>       confirm: '{{ yesno }}'
12,13c17,18
<       pkgpath: 'https://aermongk-dev'
<       #pkgname: 'xrv9k-mpls-2.0.0.0-r60204I.x86_64.rpm'
---
>       pkgpath: 'tftp://192.168.1.1/6.1.1'
>       pkgname: 'xrv9k-k9sec-3.1.0.0-r61119I.x86_64.rpm xrv9k-mgbl-3.0.0.0-r61119I.x86_64.rpm xrv9k-ospf-1.0.0.0-r61119I.x86_64.rpm'
Only in .: x.diff
